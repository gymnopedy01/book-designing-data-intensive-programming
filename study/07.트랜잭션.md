# 트랜잭션

## 애매모호한트랜잭션의 개념
 - 트랜잭션 : 애플리케이션에서 몇개의 읽기와 쓰기를 하나의 논리적 단위로 묶어서 한 연산으로 실행됨. 해당 연산은 전체가 성공(커밋)하거나 실패(어보트,롤백)함
### ACID의 의미
 - 원자성 Atomicity : 
 - 일관성 Consistency : 
 - 격리성 Isolation : 
 - 지속성 Duration : 
#### 어보트
 트랜잭션의 핵심 기능이다. 오류가 생기면 어보트되고 **안전하게 재시도** 할 수 있다.

### 단일 객체 연산과 다중 객체 연산

 - 더티 읽기 dirty read 
   - 트랜잭션이 데이터베이스에 데이터를 썻지만 아직 커밋되거나 어보트 되지 않은 상태에서 다른 트랜잭션이 이를 볼 수 있다.
   - 일부는 갱신된 값을, 일부는 갱신되지 않은 값을 볼 수 있다. 이는 사용자에게 혼란을 주며, 값을 읽은후 프로세스를 결정하는 트랜잭션이 있다면 잘못된 결정을 하는 원인이 될 수 있다.
   - 하나의 트랜잭션이 로우 수준 객체 잠ㄱ므을 획득하여 트랜잭션이 커밋되거나 어보트될 때 까지

 - 더티 쓰기 dirty write 
   - 트랜잭션이 데이터베이스에 데이터를 썻지만 아직 커밋 되거나 어보트 되지 않은 상태에서 나중에 수행한 다른 트랜잭션이 이를 덮어써서 커밋한다.
   - 동시  쓰기 작업 시 발생하는 쓰기 충돌 중 하나이다.
   - 하나의 트랜잭션이 로우 수준 객체 잠금을 획득하여 트랜잭션이 커밋되거나 어보트될 때까지 잠금을 보유하다가 쓰기가 끝난 후 해제하는 쓰기잠금을 통해 구현할 수 있다.
   - 대부분의 트랜잭션 구현을 통해 방지할 수 있다.

 - 갱신 손실 
   - 동시 쓰기 작업 시 발생하는 쓰기 충돌 중 하나이며, 애플리케이션이 데이터베이스에서 값을읽고 변경한 후 변경된 값을 다시 쓸때 발생(read-modify-write 주기)
   - 두 트랜잭션이 read-modify-write 작업을 동시에 하면 두 번째 쓰기 작업이 첫 번째 변경을 포함하지 않으므로 변경중 하나는 손실될 수 있음
   - 더티 쓰기가 아닌 정상적인 프로세스임에도 결과값과 기대값이 다름
   - 갱신 손실을 방지하는 방법은 아래에 따로 정리함

 - 읽기 스큐 read skew (혹은 비반복 읽기 nonrepeatable read)
   - 더티 읽기가 아닌 정상적인 프로세스 임에도 시간 차이로 인해 발생하는 이상 현상
   - 백업, 분석 질의, 주기적인 무결성 확인 등의 작업에서는 큰 이슈가 될 수 있음
   - **스냅숏** 격리를 통해 방지할수 있음

 - 쓰기 스큐
   - 두 트랜잭션이 두 개의 다른 객체를 갱신 하거나 같은 객체들을 읽어 그 일부를 갱신(더티 쓰기나 갱신 손실과 함께 발생할 수 있음) 할 때 정책적인 측면에서 위반 사항 발생
   - 주로 select후 요구사항의 만족 여부를 확인하여 쓰기 작업 후 커밋하는 과정에서 발생

### 갱신손실방지
 - 원자적연산
 - 잠금
 - 자동 감지   
 - compare-and-set

## 완화된 격리 수준
### 커밋 전 읽기
### 커밋 후 읽기
### 스냅숏 격리

## 직렬성 격리
